:root{
  --bg:#0f1221; --panel:#161a2e; --accent:#7bd3ff; --ok:#59e38b; --bad:#ff6b6b; --ink:#eef3ff; --muted:#a7b0d0;
  --font-main:'VT323', monospace;
}

/* ==== Global base (font smaller + lighter, consistent everywhere) ==== */
html,body{
  margin:0; padding:0;
  background:var(--bg); color:var(--ink);
  font-family:var(--font-main);
  font-weight:400;
  font-size:18px;           /* readable but not chunky */
  letter-spacing:.5px;
}

.wrap{max-width:980px;margin:0 auto;padding:16px 16px 64px}

/* Header / brand */
header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 16px}
.brand{
  font-family:var(--font-main);
  letter-spacing:1px;
  font-size:18px;           /* smaller than before */
}

/* Pills + cards */
.pill{background:var(--panel);border:1px solid #2a2f50;border-radius:999px;padding:8px 12px;font-size:14px;color:var(--muted)}
.grid{display:grid;gap:12px}
.levels{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.card{background:var(--panel);border:1px solid #242947;border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:8px}
.card h3{margin:0 0 4px;font-size:18px}
.lock{color:var(--muted);font-size:14px}

/* Buttons (lighter weight + arcade edges later) */
button{
  background:transparent;border:1px solid var(--accent);color:var(--accent);
  padding:10px 14px;border-radius:10px;cursor:pointer;
  font-family:var(--font-main); font-weight:400; letter-spacing:.5px; font-size:18px;
}
button:hover{background:rgba(123,211,255,.08)}
.ghost{opacity:.65}
.smallbtn{font-size:12px;padding:6px 10px}

/* Modal (intro story) */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:10}
.modal-card{background:var(--panel);border:1px solid #242947;border-radius:12px;padding:16px;max-width:760px;width:95%}
.story-head{display:flex;gap:12px;align-items:center}
.intro-img{width:140px;height:140px;object-fit:cover;border-radius:10px;border:1px solid #2a2f50;image-rendering:pixelated}
.story{line-height:1.5}

/* HUD */
.hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}

/* (legacy circles removed; hearts added further below) */
.bar{height:10px;background:#2a2f50;border-radius:999px;overflow:hidden;flex:1;min-width:180px}
.fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#9df7c9)}
.note{font-size:13px;color:var(--muted)}
.panel{background:var(--panel);border:1px solid #242947;border-radius:12px;padding:14px}
.qcode{
  white-space:pre-wrap;background:#11142a;border:1px dashed #2a2f50;border-radius:8px;padding:8px;margin-top:8px;color:#cfe3ff;
  font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:14px;
}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.spacer{flex:1}
.tag{font-size:12px;border:1px solid #2a2f50;border-radius:999px;padding:4px 8px;color:var(--muted)}

/* ===== ANSWERS — high contrast & readable ===== */
.options{display:grid;gap:10px;margin-top:12px}
.options button{
  background:#0c1024;
  border-color:#3a64ff;
  color:#e9f0ff;
  text-align:left;

  /* arcade-but-readable */
  font-family:var(--font-main);
  letter-spacing:.5px;
  font-size:18px;
  padding:8px 12px;

  background: linear-gradient(180deg, #0e1430, #0a0f24);
  border: 2px solid #364cdd;
  box-shadow:
    0 0 0 2px rgba(54,76,221,.25) inset,
    0 6px 0 0 #060a1a,
    0 10px 18px rgba(0,0,0,.45);
  text-shadow: 0 0 6px rgba(150,180,255,.25);
}
.options button:hover{ transform: translateY(-1px); background:#12183a }
.options button:active{ transform: translateY(1px); box-shadow: 0 0 0 2px rgba(54,76,221,.25) inset, 0 3px 0 0 #060a1a, 0 6px 10px rgba(0,0,0,.45); }
.options button:disabled{opacity:.9}
.good{outline:3px solid var(--ok) !important}
.bad{outline:3px solid var(--bad) !important}

/* ===== Retro CRT Stage ===== */
.stage {
  position: relative;
  height: 240px;
  border: 2px solid #2a2f50;
  border-radius: 12px;
  overflow: hidden;
  background: radial-gradient(1200px 500px at 50% 120%, #0c0f1f 0%, #0a0d1b 40%, #070a15 100%);
  margin-bottom: 12px;
}
.scanlines {
  pointer-events: none;
  position: absolute; inset: 0;
  background-image: repeating-linear-gradient(to bottom, rgba(255,255,255,0.03), rgba(255,255,255,0.03) 1px, transparent 1px, transparent 3px);
  mix-blend-mode: overlay;
}
.starfield::before, .starfield::after {
  content: "";
  position: absolute; inset: -50%;
  background:
    radial-gradient(2px 2px at 20% 30%, #8bd1ff 60%, transparent 61%) ,
    radial-gradient(1px 1px at 80% 70%, #8bd1ff 60%, transparent 61%) ,
    radial-gradient(1px 1px at 50% 10%, #8bd1ff 60%, transparent 61%) ,
    radial-gradient(1px 1px at 60% 50%, #8bd1ff 60%, transparent 61%) ,
    radial-gradient(1px 1px at 30% 80%, #8bd1ff 60%, transparent 61%);
  animation: drift 40s linear infinite;
  opacity: 0.6;
}
.starfield::after { animation-duration: 65s; opacity: 0.35; }
@keyframes drift { to { transform: translateY(25%); } }

/* Boss sprite + name */
.boss-wrap { position: absolute; left: 50%; top: 56%; transform: translate(-50%, -50%); text-align: center; }
#bossSprite {
  width: 180px; height: 180px; object-fit: cover;
  image-rendering: pixelated;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,.6));
  transform-origin: center;
  transition: filter .18s ease, transform .18s ease, opacity .18s ease;
}
.boss-name {
  margin-top: -6px;
  font-family:var(--font-main);
  font-size: 14px;
  letter-spacing: 1px;
  color: var(--accent);
  text-shadow: 0 0 6px rgba(123,211,255,.5);
}

/* Simple bob */
#bossSprite { animation: bob 2.2s ease-in-out infinite; }
@keyframes bob { 0%,100%{ transform: translateY(-2px); } 50%{ transform: translateY(3px); } }

/* Boss state effects using single idle image */
.boss--hit #bossSprite {
  filter: hue-rotate(-20deg) saturate(1.6) brightness(1.25) drop-shadow(0 0 10px rgba(255,80,80,.8));
  transform: scale(1.03);
}
.boss--dead #bossSprite { filter: grayscale(1) brightness(.6) contrast(.9); opacity: .9; }
.stage.boss--hit::after {
  content:""; position:absolute; inset:0;
  background: radial-gradient(closest-side, rgba(255,60,60,.2), transparent 70%);
  pointer-events:none; animation: hitfade .25s ease;
}
@keyframes hitfade { from {opacity:.7;} to {opacity:0;} }

/* Toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#0b0e1e;border:1px solid #1e2340;padding:10px 14px;border-radius:10px;color:var(--ink);opacity:0;transition:opacity .25s,transform .25s;pointer-events:none}
.toast.show{opacity:1;transform:translate(-50%,0)}

/* Review list */
.review li{margin:6px 0}

/* Boss HP layout + bar visuals */
.hp-wrap { display:flex; flex-direction:column; gap:6px; min-width:220px; flex:1; }
.hp-label { font-size:12px; color:var(--muted); display:flex; align-items:center; gap:6px }
.bar{ height:10px; background:#2a2f50; border-radius:999px; overflow:hidden; flex:1; min-width:180px; }
.fill{ height:100%; width:0; background:linear-gradient(90deg,var(--accent),#9df7c9); transition: width .25s ease; }
#hpCount { font-family:var(--font-main); letter-spacing:.5px; }

/* ===== Drag & drop question UI (typography unified) ===== */
.drag-wrap{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.tiles, .buckets { display:grid; gap:10px; }

.tile {
  background:#0c1024; border:1px dashed #3a64ff; color:#e9f0ff;
  border-radius:10px; padding:10px; cursor:grab; user-select:none;
  font-family:var(--font-main); font-weight:400; font-size:18px; letter-spacing:.5px;
}
.tile:active { cursor:grabbing; }

.bucket {
  background:#10142a; border:1px dashed #39406c; color:#cfe3ff;
  border-radius:10px; min-height:50px; padding:10px;
  font-family:var(--font-main); font-weight:400; font-size:18px; letter-spacing:.5px;
}
.bucket .chosen { margin-top:6px; font-weight:400; color:#e9f0ff; }
.bucket.correct{ outline:2px solid var(--ok); }
.bucket.wrong{ outline:2px solid var(--bad); }

/* Make disabled hint button visually obvious when used for this question */
button[disabled].hintlock { opacity:.5; filter:saturate(.6); cursor:not-allowed; }

/* Hide a tile once it’s been placed */
.tile.hidden { display: none; }

/* ===== Callouts (hint / correct / wrong) ===== */
.callout {
  margin-top: 12px; padding: 12px 14px; border-radius: 12px;
  background: #0b1025; border: 1px solid #2c3a80; color: #e8efff;
  line-height: 1.5; box-shadow: 0 8px 18px rgba(0,0,0,.25);
  text-shadow: 0 0 6px rgba(200,220,255,.15);
}
.callout strong { font-weight: 800; }
.callout--hint   { border-color: #8fb3ff; box-shadow: 0 8px 18px rgba(143,179,255,.12); }
.callout--good   { border-color: #4ce391; box-shadow: 0 8px 18px rgba(76,227,145,.12); }
.callout--bad    { border-color: #ff6b6b; box-shadow: 0 8px 18px rgba(255,107,107,.12); }
.callout .title  { display:inline-block; margin-right: 8px; opacity:.9; }
.callout-appear { animation: callin .18s ease-out; }
@keyframes callin { from { transform: translateY(-6px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* Add badges to answers after submission */
.options button { position: relative; }
.answer-badge {
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  font-weight:800; border-radius:8px; padding:2px 6px; font-size:12px;
  border:1px solid transparent;
}
.answer-badge.good  { color:#2ee38a; border-color:#2ee38a; }
.answer-badge.bad   { color:#ff6b6b; border-color:#ff6b6b; }

/* After submission, buckets stop accepting drops (visual hint) */
.bucket.locked { pointer-events: none; opacity: .85; }

/* ===== Pixel hearts for lives ===== */
.hearts { display:flex; gap:8px; align-items:center }
.hearts svg { width:22px; height:18px; image-rendering:pixelated }
.heart-fill { fill:#ff4f7a; filter: drop-shadow(0 2px 0 #8a1e38) drop-shadow(0 0 8px rgba(255,79,122,.3)); }
.heart-off  { fill:#303459; opacity:.55; filter:none; }

/* ===== Cabinet / CRT polish ===== */
.wrap {
  background:
    radial-gradient(1000px 400px at 50% -200px, rgba(120,180,255,.05), transparent 60%),
    radial-gradient(800px 600px at 120% 120%, rgba(255,120,200,.03), transparent 60%),
    radial-gradient(900px 700px at -10% 130%, rgba(120,255,200,.03), transparent 60%);
  border: 2px solid #2a2f50; border-radius: 16px;
  box-shadow: 0 0 0 6px #0a0d1b inset, 0 20px 60px rgba(0,0,0,.6);
}

/* Marquee (header) */
header {
  background: linear-gradient(180deg,#171b33,#0f1328 70%);
  padding: 10px 14px;
  border: 2px solid #2a2f50; border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,.5), inset 0 -4px 0 rgba(255,255,255,.03);
}

/* Panels look like arcade modules */
.panel, .card {
  box-shadow: 0 12px 28px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);
}

/* Boss label more arcade */
.boss-name{
  letter-spacing: 1.5px;
  text-shadow:
    0 0 6px rgba(123,211,255,.55),
    0 0 16px rgba(123,211,255,.28);
}

/* --- Boss hit bounce (random nudge; we set CSS variables from JS) --- */
.boss-bounce {
  animation: bossBounce .18s ease-out;
}
@keyframes bossBounce {
  0%   { transform: translate(var(--hitX,0), var(--hitY,0)) rotate(var(--hitR,0)); }
  100% { transform: translate(0,0) rotate(0); }
}

/* --- Boss defeat: roll/spin off-screen --- */
.boss-roll-out {
  animation: bossRollOut .9s cubic-bezier(.35,.8,.2,1);
  transform-origin: 50% 60%;
}
@keyframes bossRollOut {
  0%   { transform: translate(0,0) rotate(0) scale(1); opacity:1; }
  70%  { transform: translate(70vw,-15vh) rotate(520deg) scale(.95); opacity:.9; }
  100% { transform: translate(110vw,-35vh) rotate(680deg) scale(.9); opacity:0; }
}

/* --- Stage results overlay (inline end screen) --- */
.stage-overlay{
  position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
  background: radial-gradient(70% 80% at 50% 45%, rgba(9,12,26,.85), rgba(9,12,26,.9));
  border-top:1px solid rgba(255,255,255,.04);
  padding:20px; gap:14px;
}
.stage-overlay .overlay-card{
  width:min(720px,92%); background:#0f1329; border:1px solid #2a2f50; border-radius:12px; padding:14px;
  box-shadow: 0 12px 28px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);
}
.stage-overlay h3{ margin:0 0 6px; font-size:22px; }
.stage-overlay .meta{ color:var(--muted); font-size:16px }
.stage-overlay .review{ max-height:38vh; overflow:auto; margin:6px 0 0; padding-right:6px }

/* --- Matrix rain canvas (subtle) --- */
.matrix-canvas{
  position:absolute; inset:0; opacity:.18; mix-blend-mode:screen; pointer-events:none; image-rendering:pixelated;
}

